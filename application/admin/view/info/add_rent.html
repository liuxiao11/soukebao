{include file="public/header" /}
<!-- body -->
<div class="layui-body my-body">
    <div class="layui-tab layui-tab-card my-tab" lay-filter="card" lay-allowClose="true">
        <ul class="layui-tab-title">
            <li class="layui-this" lay-id="1"><span><i class="layui-icon">&#xe638;</i>租房信息添加页</span></li>
        </ul>
        <div class="layui-tab-content" style="margin-left: 20px">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>租房信息发布</legend>
            </fieldset>
            <form class="layui-form layui-form-pane" action="" id="formdata" method="post" style="margin-left: 20px" enctype="multipart/form-data">
                <div class="layui-form-item">
                    <label class="layui-form-label">标题添加</label>

                    <div class="layui-input-inline">
                        <input type="text" name="name" lay-verify="required" placeholder="请输入" autocomplete="off"
                               class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">用户选择</label>

                    <div class="layui-input-block">
                        <select name="user_id" lay-filter="aihao">
                            <option value=""></option>
                            {volist name="data" id="vo"}
                            <option value="{$vo.id}">{$vo.user_name}</option>
                            {/volist}
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">联系电话</label>

                    <div class="layui-input-inline">
                        <input type="text" name="phone" lay-verify="required" placeholder="请输入" autocomplete="off"
                               class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">角色选择</label>

                    <div class="layui-input-block">
                        <select name="role" lay-filter="aihao">
                            <option value=""></option>
                            <option value="0">个人</option>
                            <option value="1" selected="">经纪人</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">价格选择</label>
                    <div class="layui-input-inline">
                        <select name="price" lay-verify="required" lay-search="">
                            <option value="">直接选择或搜索选择</option>
                            <option value="<500">500以下</option>
                            <option value="500-1500">500-1500</option>
                            <option value="1500-2500">1500-2500</option>
                            <option value="2500-3500">2500-3500</option>
                            <option value="3500-4500">3500-4500</option>
                            <option value=">4500">4500以上</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">面积选择</label>
                    <div class="layui-input-inline">
                        <select name="area" lay-verify="required" lay-search="">
                            <option value="">直接选择或搜索选择</option>
                            <option value="<50">50以下</option>
                            <option value="50-100">50-100</option>
                            <option value="100-150">100-150</option>
                            <option value="250-300">250-300</option>
                            <option value="300-350">300-350</option>
                            <option value=">350">350以上</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item layui-form-pane">
                    <label class="layui-form-label">城市区域选择</label>
                    <div class="layui-input-inline">
                        <select name="province" lay-verify="required" lay-search="" lay-skin="select"
                                lay-filter="province">
                            <option value="">请选择省</option>
                            {volist name="province" id="v"}
                            <option value="{$v.code}">{$v.name}</option>
                            {/volist}
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="city" lay-verify="required" lay-search="" lay-skin="select" lay-filter="city"
                                id="city">
                            <option value="">请选择市/县</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="area1" lay-verify="required" lay-search="" lay-skin="select" lay-filter="area"
                                id="area">
                            <option value="">请选择镇区</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">具体地址</label>

                    <div class="layui-input-inline">
                        <input type="text" name="address" lay-verify="required" placeholder="请输入" autocomplete="off"
                               class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">房源类型</label>

                    <div class="layui-input-block">
                        <select name="type" lay-filter="aihao">
                            <option value=""></option>
                            {volist name="category" id="v"}
                            <option value="{$v.id}">{$v.name}</option>
                            {/volist}
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">上传图片</label>

                    <div class="layui-input-block">
                        <input type="file" name="img[]" /> <br>
                        <input type="file" name="img[]" /> <br>
                        <input type="file" name="img[]" /> <br>
                    </div>
                </div>
                <hr>
                <div class="layui-form-item">
                    <button class="layui-btn" lay-submit="" lay-filter="sub">提交</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- footer -->
<div class="layui-footer my-footer">

</div>
</div>

<!-- 右键菜单 -->
<div class="my-dblclick-box none">
    <table class="layui-tab dblclick-tab">
        <tr class="card-refresh">
            <td><i class="layui-icon">&#x1002;</i>刷新当前标签</td>
        </tr>
        <tr class="card-close">
            <td><i class="layui-icon">&#x1006;</i>关闭当前标签</td>
        </tr>
        <tr class="card-close-all">
            <td><i class="layui-icon">&#x1006;</i>关闭所有标签</td>
        </tr>
    </table>
</div>
{include file="public/header_js" /}
</body>
</html>
<script src="../frame/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript">
    layui.use(['form', 'layedit', 'laydate', 'element'], function () {
        var form = layui.form
                , layer = layui.layer
                , layedit = layui.layedit


        //自定义验证规则
        form.verify({
            title: function (value) {
                if (value.length < 5) {
                    return '标题至少得5个字符啊';
                }
            }
            , pass: [/(.+){6,12}$/, '密码必须6到12位']
            , content: function (value) {
                layedit.sync(editIndex);
            }
        });

        //监听提交
        form.on('submit(sub)', function (data) {
            var formData = $("#formdata").serialize();
            $.ajax({
                type: "post",
                url: "{:url('Info/addRent')}",
                data: formData,//这里data传递过去的是序列化以后的字符串
                success: function (data) {
                    if (data) {
                        window.location.href = `/admin/Info/infpRent`;
                    }
                }
            });
        });


        // you code ...
    });
</script>
<script>
    layui.use(['form', 'layedit', 'laydate'],
            function () {
                var $ = layui.jquery,
                        form = layui.form,
                        layer = layui.layer,
                        layedit = layui.layedit,
                        laydate = layui.laydate;

                //监听省份选择
                form.on('select(province)',
                        function (data) {
                            console.log(data);
                            $('#city').html('<option value="">请选择市/县</option>');
                            $('#area').html('<option value="">请选择镇区</option>');
                            $.ajax({
                                url: "{:url('Info/city')}",
                                data: {
                                    provincecode: data.value
                                },
                                type: 'POST',
                                dataType: 'json',
                                success: function (data1) {
                                    if (data1.error == 0) {
                                        $("#city").append(data1.option);
                                        form.render('select'); //刷新select选择框渲染
                                    }
                                }
                            });
                        });
                form.on('select(city)',
                        function (data) {
                            $('#area').html('<option value="">请选择镇区</option>');
                            $.ajax({
                                url: "{:url('Info/area')}",
                                data: {
                                    citycode: data.value
                                },
                                type: 'POST',
                                dataType: 'json',
                                success: function (data1) {
                                    if (data1.error == 0) {
                                        $("#area").append(data1.option);
                                        form.render('select'); //刷新select选择框渲染
                                    }
                                }
                            });
                        });


            });
</script>
